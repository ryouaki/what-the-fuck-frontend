# 预加载

预加载，可以提前将页面所需要的资源加载到客户端本地，往往可以起到优化页面显示速度的作用。帮助提高页面性能，提升用户体验。

### 预加载的模式
#### 接口数据预加载
在移动端上拉加载的列表页，虽然页面只显示其中10条数据，但是为了页面交互的流畅，往往首屏加载20条两屏的数据。显示第一屏10条。在下拉的时候显示再显示第二屏的10条，并同时加载第三屏数据。从而整个页面上拉加载的过程会非常流畅。用户体验极佳。

#### 图片资源预加载
图标，背景图，这些资源，由于其在整个网站使用极其频繁。如果在需要的时候再去加载，就需要一定的延时，因此提前将这些资源加载，会起到事半功倍的效果。页面交互更加自然，流畅。

#### js脚本预加载
基于SPA架构的路由分割前端系统。由于其进入对应页面才开始加载对应的资源。因此在每次切换路由的时候，都需要进行js页面资源的加载。这样也就会造成一定的延时。为了解决这个问题，可以使用preload，prefetch将对应的js资源预加载，以解决这个问题。

#### DNS预解析
DNS解析会造成一定延时，因此使用`<link rel="dns-prefetch" href="//domain.com">`可以提升DNS解析速度。提高前端性能。

#### 数据缓存
数据缓存也是一种常见的技术，会将用户客户端经常使用的数据，或者兜底数据保存在客户端，在下次打开的时候，由于可以避免接口请求直接拿到数据，可以极大地提高应用的启动速度。

#### css预加载
css文件，绝大多数情况下我们只打包成一个css文件，而该文件内容并不是每个页面都需要。但是也是一次性吐给客户端。一是为了浏览器可以提前生成渲染树，二是提前加载这些资源，减少资源加载造成的延时导致页面显示速度变慢。

### 预加载的反模式

#### 资源预加载
由于浏览器有明确的并行下载限制，如果将所有觉得重要的资源都提前加载，会阻塞首屏渲染，导致首屏显示速度慢。所以并不是预加载就一定会提升性能。预加载之后用户可能需要使用到的资源才会起到提升性能的作用。

#### preload&prefetch同时使用
preload是提前加载，prefetch是预加载，会在闲时开始加载指定资源，那么如果我就觉得这个资源非常重要，那么preload和prefetch都用上会不会加载的更快呢？其实是恰恰相反的，preload是优先加载，prefetch可能会使用到的资源会在闲时加载。但是如果同时对一个文件使用，则会造成文件重复加载。导致网络资源浪费。而preload会抢占下载连接数。导致其他资源无法下载。

而一般我建议，当前页面需要用到的资源使用preload，后续页面需要使用的资源使用prefetch。不过对于spa系统很难设置。通常我的做法是只在html模板文件preload首屏资源。

#### 数据本地缓存
为了加快App启动速度。我们通常会将一部分资源和数据保存在客户端本地。但是如果用户再次登录App的时候之前的数据已经失效了呢？如果缓存的是用户登陆数据，再次使用该设备的是别人？那么就会导致信息安全问题。在缓存数据的时候，一定要考虑数据时效性，数据安全性，数据一致性。否则就会带来其他问题。

对于预加载还有很多模式与反模式，其实归结一点就是使用的度。用对了，就是模式，用过了，就成了反模式。
